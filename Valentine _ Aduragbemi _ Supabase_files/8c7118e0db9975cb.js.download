;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="55b98691-e25a-6e32-b656-1521b0dc194c")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,358085,e=>{"use strict";var s=e.i(478902),t=e.i(55956),r=e.i(744524),a=e.i(536068),i=e.i(17203),n=e.i(210419),o=e.i(389959);e.i(128328);var l=e.i(158639),d=e.i(743371),c=e.i(867637),u=e.i(93558),h=e.i(10429),p=e.i(206413),m=e.i(178527),g=e.i(837710);let x=({isFreePlan:e,upgradeUrl:t,severity:r})=>"warning"===r?(0,s.jsxs)(m.Alert_Shadcn_,{variant:"warning",children:[(0,s.jsx)(c.AlertCircle,{}),(0,s.jsx)(u.AlertTitle,{children:"Your max CPU usage has exceeded 80%"}),(0,s.jsx)(p.AlertDescription_Shadcn_,{children:"High CPU usage could result in slower queries, disruption of daily back up routines, and in rare cases, your instance may become unresponsive. If you need more resources, consider upgrading to a larger compute add-on."}),(0,s.jsxs)("div",{className:"mt-3 flex items-center space-x-2",children:[(0,s.jsx)(g.Button,{asChild:!0,type:"default",children:(0,s.jsx)(n.default,{href:`${h.DOCS_URL}/guides/troubleshooting/high-cpu-usage`,children:"Learn more"})}),(0,s.jsx)(g.Button,{asChild:!0,type:"warning",children:(0,s.jsx)(n.default,{href:t,children:e?"Upgrade project":"Change compute add-on"})})]})]}):"critical"===r?(0,s.jsxs)(m.Alert_Shadcn_,{variant:"destructive",children:[(0,s.jsx)(c.AlertCircle,{}),(0,s.jsx)(u.AlertTitle,{children:"Your max CPU usage has reached 100%"}),(0,s.jsx)(p.AlertDescription_Shadcn_,{children:"High CPU usage could result in slower queries, disruption of daily back up routines, and in rare cases, your instance may become unresponsive. If you need more resources, consider upgrading to a larger compute add-on."}),(0,s.jsxs)("div",{className:"mt-3 flex items-center space-x-2",children:[(0,s.jsx)(g.Button,{asChild:!0,type:"default",children:(0,s.jsx)(n.default,{href:`${h.DOCS_URL}/guides/troubleshooting/high-cpu-usage`,children:"Learn more"})}),(0,s.jsx)(g.Button,{asChild:!0,type:"danger",children:(0,s.jsx)(n.default,{href:t,children:e?"Upgrade project":"Change compute add-on"})})]})]}):null;var f=e.i(710483);let j=({isFreePlan:e,hasLatest:t,currentBillingCycleSelected:r,upgradeUrl:a,latestIoBudgetConsumption:i,highestIoBudgetConsumption:o})=>t&&i>=100?(0,s.jsx)(f.Admonition,{type:"destructive",title:"Your Disk IO Budget has been used up",description:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"mb-4",children:"Your workload has used up all your Disk IO Budget and is now running at the baseline performance. If you need consistent disk performance, consider upgrading to a larger compute add-on."}),(0,s.jsx)(g.Button,{asChild:!0,type:"danger",children:(0,s.jsx)(n.default,{href:a,children:e?"Upgrade project":"Change compute add-on"})})]})}):t&&i>=80?(0,s.jsx)(f.Admonition,{type:"destructive",title:"You are close to running out of Disk IO Budget",description:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{className:"mb-4",children:["Your workload has consumed ",i,"% of your Disk IO Budget. If you use up all your Disk IO Budget, your instance will reverted to baseline performance. If you need consistent disk performance, consider upgrading to a larger compute add-on."]}),(0,s.jsx)(g.Button,{asChild:!0,type:"danger",children:(0,s.jsx)(n.default,{href:a,children:e?"Upgrade project":"Change compute add-on"})})]})}):r&&o>=100?(0,s.jsx)(f.Admonition,{type:"warning",title:"You ran out of IO Budget at least once",description:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"mb-4",children:"Your workload has used up all your Disk IO Budget and reverted to baseline performance at least once during this billing cycle. If you need consistent disk performance, consider upgrading to a larger compute add-on."}),(0,s.jsx)(g.Button,{asChild:!0,type:"warning",children:(0,s.jsx)(n.default,{href:a,children:e?"Upgrade project":"Change compute add-on"})})]})}):r&&o>=80?(0,s.jsx)(f.Admonition,{type:"warning",title:"You were close to using all your IO Budget at least once",description:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{className:"mb-4",children:["Your workload has consumed ",o,"% of your Disk IO budget during this billing cycle. If you use up all your Disk IO Budget, your instance will reverted to baseline performance. If you need consistent disk performance, consider upgrading to a larger compute add-on."]}),(0,s.jsx)(g.Button,{asChild:!0,type:"warning",children:(0,s.jsx)(n.default,{href:a,children:e?"Upgrade project":"Change compute add-on"})})]})}):null,_=({isFreePlan:e,upgradeUrl:t,severity:r})=>"warning"===r?(0,s.jsxs)(m.Alert_Shadcn_,{variant:"warning",children:[(0,s.jsx)(c.AlertCircle,{}),(0,s.jsx)(u.AlertTitle,{children:"Your memory usage has exceeded 80%"}),(0,s.jsx)(p.AlertDescription_Shadcn_,{children:"High memory usage could result in overall degraded performance, and in rare cases, your instance may become unresponsive. If you need more resources, consider upgrading to a larger compute add-on."}),(0,s.jsxs)("div",{className:"mt-3 flex items-center space-x-2",children:[(0,s.jsx)(g.Button,{asChild:!0,type:"default",children:(0,s.jsx)(n.default,{href:`${h.DOCS_URL}/guides/troubleshooting/exhaust-ram`,children:"Learn more"})}),(0,s.jsx)(g.Button,{asChild:!0,type:"warning",children:(0,s.jsx)(n.default,{href:t,children:e?"Upgrade project":"Change compute add-on"})})]})]}):"critical"===r?(0,s.jsxs)(m.Alert_Shadcn_,{variant:"destructive",children:[(0,s.jsx)(c.AlertCircle,{}),(0,s.jsx)(u.AlertTitle,{children:"Your memory usage has reached 100%"}),(0,s.jsx)(p.AlertDescription_Shadcn_,{children:"High memory usage could result in overall degraded performance, and in rare cases, your instance may become unresponsive. If you need more resources, consider upgrading to a larger compute add-on."}),(0,s.jsxs)("div",{className:"mt-3 flex items-center space-x-2",children:[(0,s.jsx)(g.Button,{asChild:!0,type:"default",children:(0,s.jsx)(n.default,{href:`${h.DOCS_URL}/guides/troubleshooting/high-cpu-usage`,children:"Learn more"})}),(0,s.jsx)(g.Button,{asChild:!0,type:"danger",children:(0,s.jsx)(n.default,{href:t,children:e?"Upgrade project":"Change compute add-on"})})]})]}):null;var b=e.i(908204),y=e.i(167892),v=e.i(282492),S=e.i(929603),w=e.i(513826),C=e.i(368315),k=e.i(147545),N=e.i(193),D=e.i(540203),I=e.i(144676),P=e.i(589314),$=e.i(265735),A=e.i(635494),O=e.i(837508),T=e.i(3251),R=e.i(189329),B=e.i(108151);let L=[{key:"infra",name:"Infrastructure",description:"Usage statistics related to your server instance",attributes:[{anchor:"cpu",key:"max_cpu_usage",attributes:[{key:"max_cpu_usage",color:"white"}],name:"CPU",unit:"percentage",description:"Max CPU usage of your server.",chartDescription:"",links:[{name:"Compute Add-Ons",url:`${h.DOCS_URL}/guides/platform/compute-add-ons`},{name:"High CPU Usage",url:`${h.DOCS_URL}/guides/troubleshooting/high-cpu-usage`},{name:"Metrics",url:`${h.DOCS_URL}/guides/platform/metrics`}]},{anchor:"ram",key:"ram_usage",attributes:[{key:"ram_usage",color:"white"}],name:"Memory",unit:"percentage",description:"Memory usage of your server.\nYou might observe elevated memory usage, even with little to no load. Besides Postgres, a wide range of services are running under the hood resulting in an elevated base memory usage.",chartDescription:"",links:[{name:"Compute Add-Ons",url:`${h.DOCS_URL}/guides/platform/compute-add-ons`},{name:"High RAM Usage",url:`${h.DOCS_URL}/guides/troubleshooting/exhaust-ram`},{name:"Metrics",url:`${h.DOCS_URL}/guides/platform/metrics`}]},{anchor:"disk_io",key:"disk_io_consumption",attributes:[{key:"disk_io_consumption",color:"white"}],name:"Disk IO Bandwidth",unit:"percentage",links:[{name:"Disk Throughput and IOPS",url:`${h.DOCS_URL}/guides/platform/compute-add-ons#disk-throughput-and-iops`},{name:"High Disk I/O",url:`${h.DOCS_URL}/guides/troubleshooting/exhaust-disk-io`},{name:"Metrics",url:`${h.DOCS_URL}/guides/platform/metrics`}],description:"The disk performance of your workload is determined by the Disk IO bandwidth.\nSmaller compute instances (below 4XL) can burst above their baseline disk throughput and IOPS for short periods of time. Beyond that, the performance reverts to the baseline.",chartDescription:""}]}];var U=e.i(49589);let M=["ci_micro","ci_small","ci_medium","ci_large","ci_xlarge","ci_2xlarge"],F=["max_cpu_usage","ram_usage","disk_io_consumption"],E=()=>{let{ref:e}=(0,l.useParams)(),{data:c}=(0,A.useSelectedProjectQuery)(),{data:u}=(0,$.useSelectedOrganizationQuery)(),p=(0,R.useDatabaseSelectorStateSnapshot)(),[m,g]=(0,o.useState)(),{data:E,isPending:Y}=(0,D.useOrgSubscriptionQuery)({orgSlug:u?.slug}),z=u?.plan?.id==="free",{data:V}=(0,P.useResourceWarningsQuery)({ref:e}),q=V?.find(s=>s.project===e),{data:Q}=(0,I.useProjectAddonsQuery)({projectRef:e}),G=Q?.selected_addons??[],{setShowNewReplicaPanel:H}=(0,U.useShowNewReplicaPanel)(),{computeInstance:W}=(0,d.getAddons)(G),K=void 0!==W&&!M.includes(W.variant.identifier),X=W?.variant.meta?W?.variant.meta:c?.infra_compute_size==="nano"?O.INSTANCE_NANO_SPECS:O.INSTANCE_MICRO_SPECS,Z=(0,o.useMemo)(()=>{if(!m?.period_start||!m?.period_end||!E)return!0;let{current_period_start:e,current_period_end:s}=E;return(0,t.default)(m.period_start.date).isSame(new Date(1e3*e))&&(0,t.default)(m.period_end.date).isSame(new Date(1e3*s))},[m,E]),J=void 0===u?"/":"free"===u.plan.id?`/org/${u?.slug??"[slug]"}/billing#subscription`:`/project/${e}/settings/addons`,ee=L.find(e=>"infra"===e.key),es=(0,o.useMemo)(()=>{if(m?.period_start?.date!=="Invalid Date")if(!m?.period_start?.date)return;else return new Date(m?.period_start?.date??0).toISOString().slice(0,-5)+"Z"},[m]),et=(0,o.useMemo)(()=>{if(m?.period_end?.date!=="Invalid Date"){if(m?.period_end?.date&&(0,t.default)(m.period_end.date).isAfter((0,t.default)()))return(0,t.default)().endOf("day").toISOString().slice(0,-5)+"Z";else if(m?.period_end?.date)return new Date(m.period_end.date??0).toISOString().slice(0,-5)+"Z"}},[m]),er="1d",ea="DD MMM";es&&et&&48>=(0,t.default)(et).diff(es,"hours")&&(er="1h",ea="h a");let{data:ei,isPending:en}=(0,N.useInfraMonitoringAttributesQuery)({projectRef:e,attributes:F,interval:er,startDate:es,endDate:et,databaseIdentifier:p.selectedDatabaseId}),eo=(0,o.useMemo)(()=>{if(ei)return(0,k.mapMultiResponseToAnalyticsData)(ei,F,ea)},[ei,ea]),el=eo?.max_cpu_usage,ed=eo?.ram_usage,ec=eo?.disk_io_consumption,eu=(0,t.default)(et).isAfter((0,t.default)().startOf("day")),eh=eu&&ec?.data?.slice(-1)?.[0]?Number(ec.data.slice(-1)[0].disk_io_consumption):0,ep=(ec?.data||[]).map(e=>Number(e.disk_io_consumption)??0).reduce((e,s)=>Math.max(e,s),0),em={max_cpu_usage:{isLoading:en,data:el?.data??[]},ram_usage:{isLoading:en,data:ed?.data??[]},disk_io_consumption:{isLoading:en,data:ec?.data??[]}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.ScaffoldContainer,{id:"infrastructure-activity",children:(0,s.jsx)("div",{className:"mx-auto flex flex-col gap-10 pt-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xl",children:"Infrastructure Activity"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Activity statistics related to your server instance"})]})})}),(0,s.jsx)(y.ScaffoldContainer,{className:"sticky top-0 py-6 border-b bg-studio z-10",children:(0,s.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,s.jsx)(v.DatabaseSelector,{}),!Y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(S.DateRangePicker,{onChange:g,value:T.TIME_PERIODS_REPORTS[0].key,options:[...T.TIME_PERIODS_BILLING,...T.TIME_PERIODS_REPORTS],loading:Y,currentBillingPeriodStart:E?.current_period_start,currentBillingPeriodEnd:E?.current_period_end}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:[(0,t.default)(es).format("DD MMM YYYY")," - ",(0,t.default)(et).format("DD MMM YYYY")]})]})]})}),ee?.attributes.map(e=>{let t=em[e.key]?.data??[];return(0,s.jsxs)(o.Fragment,{children:[(0,s.jsx)(y.ScaffoldContainer,{id:e.anchor,children:(0,s.jsxs)(y.ScaffoldSection,{children:[(0,s.jsx)(y.ScaffoldSectionDetail,{children:(0,s.jsxs)("div",{className:"sticky top-32 space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("div",{className:"flex items-center space-x-2",children:(0,s.jsx)("h4",{className:"text-base capitalize m-0",children:e.name})}),(0,s.jsx)("div",{className:"grid gap-4",children:e.description.split("\n").map((e,t)=>(0,s.jsx)("p",{className:"text-sm text-foreground-light pr-8 m-0",children:e},`desc-${t}`))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-sm text-foreground mb-2",children:"More information"}),e.links.map(e=>(0,s.jsx)("div",{children:(0,s.jsx)(n.default,{href:e.url,target:"_blank",rel:"noreferrer",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2 opacity-50 hover:opacity-100 transition",children:[(0,s.jsx)("p",{className:"text-sm m-0",children:e.name}),(0,s.jsx)(i.ExternalLink,{size:16,strokeWidth:1.5})]})})},e.url))]})]})}),(0,s.jsxs)(y.ScaffoldSectionContent,{children:["disk_io_consumption"===e.key&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j,{upgradeUrl:J,isFreePlan:z,hasLatest:eu,currentBillingCycleSelected:Z,latestIoBudgetConsumption:eh,highestIoBudgetConsumption:ep}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{children:"Disk IO Bandwidth"}),X.baseline_disk_io_mbs===X.max_disk_io_mbs?(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["Your current compute has a baseline and maximum disk throughput of"," ",X.max_disk_io_mbs?.toLocaleString()," Mbps."]}):(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["Your current compute can burst above the baseline disk throughput of"," ",X.baseline_disk_io_mbs?.toLocaleString()," ","Mbps for short periods of time."]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm mb-2",children:"Overview"}),(0,s.jsxs)("div",{className:"flex items-center justify-between border-b py-1",children:[(0,s.jsx)("p",{className:"text-xs text-foreground-light",children:"Current compute instance"}),(0,s.jsx)("p",{className:"text-xs",children:W?.variant?.name??(0,r.default)(c?.infra_compute_size)??"Micro"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between border-b py-1",children:[(0,s.jsx)("p",{className:"text-xs text-foreground-light",children:"Baseline IO Bandwidth"}),(0,s.jsxs)("p",{className:"text-xs",children:[X.baseline_disk_io_mbs?.toLocaleString()," ","Mbps"]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between border-b py-1",children:[(0,s.jsx)("p",{className:"text-xs text-foreground-light",children:"Maximum IO Bandwidth (burst limit)"}),(0,s.jsxs)("p",{className:"text-xs",children:[X.max_disk_io_mbs?.toLocaleString()," Mbps"]})]}),X.max_disk_io_mbs!==X?.baseline_disk_io_mbs&&(0,s.jsxs)("div",{className:"flex items-center justify-between py-1",children:[(0,s.jsx)("p",{className:"text-xs text-foreground-light",children:"Daily burst time limit"}),(0,s.jsx)("p",{className:"text-xs",children:"30 mins"})]})]})]}),"max_cpu_usage"===e.key&&(0,s.jsx)(x,{isFreePlan:z,upgradeUrl:J,severity:q?.cpu_exhaustion}),"ram_usage"===e.key&&(0,s.jsx)(_,{isFreePlan:z,upgradeUrl:J,severity:q?.memory_and_swap_exhaustion}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("div",{className:"flex flex-row justify-between",children:"disk_io_consumption"===e.key?(0,s.jsxs)("p",{children:["Disk IO consumed per ","1d"===er?"day":"hour"]}):(0,s.jsxs)("p",{children:["Max"," ",(0,s.jsx)("span",{className:"ram_usage"===e.key?"lowercase":"",children:e.name})," ","utilization per ","1d"===er?"day":"hour"]})}),"ram_usage"===e.key&&(0,s.jsxs)("div",{className:"text-sm text-foreground-light",children:[(0,s.jsxs)("p",{children:["Your compute instance has ",X.memory_gb," GB of memory."]}),1===X.memory_gb&&(0,s.jsx)("p",{children:"As your project is running on the smallest compute instance, it is not unusual for your project to have a base memory usage of ~50%."})]}),"max_cpu_usage"===e.key&&(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["Your compute instance has ",X.cpu_cores," CPU cores."]}),e.chartDescription.split("\n").map((e,t)=>(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:e},`para-${t}`))]}),"disk_io_consumption"===e.key&&K?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(f.Admonition,{type:"note",title:`Your compute instance of ${W.variant.name} comes with dedicated I/O resources`,description:"Your project thus does not rely on I/O balance or burst capacity as larger add-ons are designed for sustained, high performance with specific IOPS and throughput limits without needing to burst.",children:(0,s.jsx)(w.DocsButton,{abbrev:!1,href:`${h.DOCS_URL}/guides/platform/compute-add-ons#disk-throughput-and-iops`})})}):em[e.key].isLoading?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(B.ShimmeringLoader,{}),(0,s.jsx)(B.ShimmeringLoader,{className:"w-3/4"}),(0,s.jsx)(B.ShimmeringLoader,{className:"w-1/2"})]}):t.length?(0,s.jsx)(b.default,{name:`${e.chartPrefix||""} ${e.name}`,unit:e.unit,attributes:e.attributes,data:t,yFormatter:e=>`${Math.round(Number(e))}%`,tooltipFormatter:e=>`${e}%`,yLimit:100}):(0,s.jsx)(C.default,{children:(0,s.jsx)(C.default.Content,{children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-2",children:[(0,s.jsx)(a.BarChart2,{size:18,className:"text-foreground-light mb-2"}),(0,s.jsx)("p",{className:"text-sm",children:"No data in period"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"May take a few minutes to show"})]})})})]})]})}),(0,s.jsx)(y.ScaffoldDivider,{})]},e.key)})]})};var Y=e.i(657588),z=e.i(524421),V=e.i(567558),q=e.i(242882),Q=e.i(86086),G=e.i(234745),H=e.i(164045),W=e.i(78162);async function K({projectRef:e},s){if(!e)throw Error("projectRef is required");let{data:t,error:r}=await (0,G.get)("/v1/projects/{ref}/upgrade/eligibility",{params:{path:{ref:e}},signal:s});return r&&(0,G.handleError)(r),t}let X=({projectRef:e},{enabled:s=!0,...t}={})=>{let{data:r}=(0,H.useProjectDetailQuery)({ref:e});return(0,q.useQuery)({queryKey:W.configKeys.upgradeEligibility(e),queryFn:({signal:s})=>K({projectRef:e},s),enabled:s&&void 0!==r&&r.status===O.PROJECT_STATUS.ACTIVE_HEALTHY&&void 0!==e&&Q.IS_PLATFORM,...t})};var Z=e.i(47302);async function J({projectRef:e},s){if(!e)throw Error("projectRef is required");let{data:t,error:r}=await (0,G.get)("/platform/projects/{ref}/service-versions",{params:{path:{ref:e}},signal:s});return r&&(0,G.handleError)(r),t}var ee=e.i(150671),es=e.i(912793),et=e.i(587433),er=e.i(171997),ea=e.i(613580),ei=e.i(532728),en=e.i(217444),eo=e.i(271226),el=e.i(408891),ed=e.i(355901),ec=e.i(97429),eu=e.i(819591),eh=e.i(592383),ep=e.i(372598),em=e.i(605317),eg=e.i(38429);async function ex({ref:e,target_version:s,release_channel:t}){let{data:r,error:a}=await (0,G.post)("/v1/projects/{ref}/upgrade",{params:{path:{ref:e}},body:{target_version:s.toString(),release_channel:t}});return a&&(0,G.handleError)(a),r}var ef=e.i(592360),ej=e.i(24315),e_=e.i(61863),eb=e.i(428353),ey=e.i(40892),ev=e.i(451031),eS=e.i(57492),ew=e.i(831927),eC=e.i(156722),ek=e.i(719754),eN=e.i(449123),eD=e.i(538482);let eI=({postgres_version:e,release_channel:s})=>`${e}|${s}`,eP=()=>{let e=(0,eo.useRouter)(),{ref:t}=(0,l.useParams)(),{data:r}=(0,$.useSelectedOrganizationQuery)(),{setProjectStatus:a}=(0,H.useSetProjectStatus)(),[i,d]=(0,o.useState)(!1),u=(0,Y.useFlag)("disableProjectUpgrade"),x=r?.plan.id??"free",{data:j}=(0,em.useDiskAttributesQuery)({projectRef:t}),{includedDiskGB:_}=eu.PLAN_DETAILS[x],b=_[j?.attributes.type??"gp3"],y=j?.attributes.size_gb!==b,{data:v}=X({projectRef:t}),S=(v?.current_app_version??"").split("supabase-postgres-")[1],w=(v?.latest_app_version??"").split("supabase-postgres-")[1],C=v?.duration_estimate_hours||1,k=v?.legacy_auth_custom_roles||[],{mutate:N,isPending:D}=(({onSuccess:e,onError:s,...t}={})=>(0,eg.useMutation)({mutationFn:e=>ex(e),async onSuccess(s,t,r){await e?.(s,t,r)},async onError(e,t,r){void 0===s?ed.toast.error(`Failed to upgrade project: ${e.message}`):s(e,t,r)},...t}))({onSuccess:(s,t)=>{a({ref:t.ref,status:O.PROJECT_STATUS.UPGRADING}),ed.toast.success("Upgrading project"),e.push(`/project/${t.ref}?upgradeInitiated=true&trackingId=${s.tracking_id}`)}}),I=async e=>{if(!t)return ed.toast.error("Project ref not found");let{postgresVersionSelection:s}=e,r=(0,ep.extractPostgresVersionDetails)(s);return r?r.postgresEngine?void N({ref:t,target_version:r.postgresEngine,release_channel:r.releaseChannel}):ed.toast.error("Missing target version"):ed.toast.error("Invalid Postgres version")},P=ec.z.object({postgresVersionSelection:ec.z.string()}),A=(0,el.useForm)({resolver:(0,ei.zodResolver)(P),mode:"onChange",defaultValues:{postgresVersionSelection:""}});return(0,o.useEffect)(()=>{let e=v?.target_upgrade_versions?.[0]?eI(v.target_upgrade_versions[0]):"";A.setValue("postgresVersionSelection",e)},[v,A]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(m.Alert_Shadcn_,{title:"Your project can be upgraded to the latest version of Postgres",children:[(0,s.jsx)(ef.AlertTitle_Shadcn_,{children:"Your project can be upgraded to the latest version of Postgres"}),(0,s.jsxs)(p.AlertDescription_Shadcn_,{children:[(0,s.jsxs)("p",{children:["The latest version of Postgres (",w,") is available for your project."]}),(0,s.jsxs)(ea.Tooltip,{children:[(0,s.jsx)(ea.TooltipTrigger,{asChild:!0,children:(0,s.jsx)(g.Button,{size:"tiny",type:"primary",className:"mt-2",onClick:()=>d(!0),disabled:u,children:"Upgrade project"})}),u&&(0,s.jsx)(ea.TooltipContent,{side:"bottom",align:"center",children:"Project upgrade is currently disabled"})]})]})]}),(0,s.jsx)(ey.Modal,{hideFooter:!0,size:"small",visible:i,onCancel:()=>d(!1),header:"Confirm to upgrade Postgres version",children:(0,s.jsx)(eb.Form_Shadcn_,{...A,children:(0,s.jsxs)("form",{onSubmit:A.handleSubmit(I),children:[(0,s.jsx)(f.Admonition,{type:"warning",className:"border-x-0 border-t-0 rounded-none",title:`Your project will be offline for up to ${C} hour${1===C?"":"s"}`,description:"It is advised to upgrade at a time when there will be minimal impact for your application."}),(0,s.jsx)(ey.Modal.Content,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("p",{className:"text-sm",children:["All services will be offline and you will not be able to downgrade back to Postgres ",S,"."]}),y&&(0,s.jsx)(eh.Markdown,{extLinks:!0,className:"text-foreground",content:`Your current disk size of ${j?.attributes.size_gb}GB will also be
                    [right-sized](${h.DOCS_URL}/guides/platform/upgrading#disk-sizing) with the upgrade.`}),(v?.potential_breaking_changes??[]).length>0&&(0,s.jsxs)(m.Alert_Shadcn_,{variant:"destructive",title:"Breaking changes",children:[(0,s.jsx)(c.AlertCircle,{className:"h-4 w-4",strokeWidth:2}),(0,s.jsx)(ef.AlertTitle_Shadcn_,{children:"Breaking changes"}),(0,s.jsxs)(p.AlertDescription_Shadcn_,{className:"flex flex-col gap-3",children:[(0,s.jsx)("p",{children:"Your project will be upgraded across major versions of Postgres. This may involve breaking changes."}),(0,s.jsx)("div",{children:(0,s.jsx)(g.Button,{size:"tiny",type:"default",asChild:!0,children:(0,s.jsx)(n.default,{href:`${h.DOCS_URL}/guides/platform/migrating-and-upgrading-projects#caveats`,target:"_blank",rel:"noreferrer",children:"View docs"})})})]})]}),k.length>0&&(0,s.jsxs)(m.Alert_Shadcn_,{variant:"warning",title:"Custom Postgres roles using md5 authentication have been detected",children:[(0,s.jsx)(en.AlertTriangle,{className:"h-4 w-4",strokeWidth:2}),(0,s.jsx)(ef.AlertTitle_Shadcn_,{children:"Custom Postgres roles will not work automatically after upgrade"}),(0,s.jsxs)(p.AlertDescription_Shadcn_,{className:"flex flex-col gap-3",children:[(0,s.jsx)("p",{children:"You must run a series of commands after upgrading."}),(0,s.jsx)("p",{children:"This is because new Postgres versions use scram-sha-256 authentication by default and do not support md5, as it has been deprecated."}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"mb-1",children:"Run the following commands after the upgrade:"}),(0,s.jsx)("div",{className:"flex items-baseline gap-2",children:(0,s.jsx)("code",{className:"text-xs",children:k.map(e=>(0,s.jsxs)("div",{className:"pb-1",children:["ALTER ROLE ",(0,s.jsx)("span",{className:"text-brand",children:e})," WITH PASSWORD '",(0,s.jsx)("span",{className:"text-brand",children:"newpassword"}),"';"]},e))})})]}),(0,s.jsx)("div",{children:(0,s.jsx)(g.Button,{size:"tiny",type:"default",asChild:!0,children:(0,s.jsx)(n.default,{href:`${h.DOCS_URL}/guides/platform/migrating-and-upgrading-projects#caveats`,target:"_blank",rel:"noreferrer",children:"View docs"})})})]})]}),(0,s.jsx)(e_.FormField_Shadcn_,{control:A.control,name:"postgresVersionSelection",render:({field:e})=>(0,s.jsx)(eD.FormItemLayout,{label:"Select the version of Postgres to upgrade to",children:(0,s.jsx)(ej.FormControl_Shadcn_,{children:(0,s.jsxs)(eN.Select_Shadcn_,{value:e.value,onValueChange:e.onChange,children:[(0,s.jsx)(eC.SelectTrigger_Shadcn_,{children:(0,s.jsx)(ek.SelectValue_Shadcn_,{placeholder:"Select a Postgres version"})}),(0,s.jsx)(ev.SelectContent_Shadcn_,{children:(0,s.jsx)(eS.SelectGroup_Shadcn_,{children:(v?.target_upgrade_versions||[])?.map(e=>{let t=e.app_version.split("supabase-postgres-")[1];return(0,s.jsx)(ew.SelectItem_Shadcn_,{value:eI(e),children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-foreground",children:t}),"ga"!==e.release_channel&&(0,s.jsx)(et.Badge,{variant:"warning",children:e.release_channel})]})},eI(e))})})})]})})})})]})}),(0,s.jsx)(ey.Modal.Separator,{}),(0,s.jsxs)(ey.Modal.Content,{className:"flex items-center space-x-2 justify-end",children:[(0,s.jsx)(g.Button,{type:"default",onClick:()=>d(!1),disabled:D,children:"Cancel"}),(0,s.jsx)(g.Button,{htmlType:"submit",disabled:D,loading:D,children:"Confirm upgrade"})]})]})})})]})};var e$=e.i(554056),eA=e.i(937942);let eO=({latestPgVersion:e})=>{let{ref:t}=(0,l.useParams)(),r=(0,Y.useFlag)("unifiedReplication");return(0,s.jsx)(f.Admonition,{type:"note",showIcon:!1,title:"A newer version of Postgres is available",description:`You will need to remove all read replicas prior to upgrading your Postgres version to the latest available (${e}).`,actions:r?(0,s.jsx)(g.Button,{asChild:!0,type:"default",children:(0,s.jsx)(n.default,{href:`/project/${t}/database/replication`,children:"Manage read replicas"})}):void 0})},eT=({error:e})=>{let{ref:t}=(0,l.useParams)(),r=(e=>{switch(e.type){case"objects_depending_on_pg_cron":return e.dependents.join(", ");case"indexes_referencing_ll_to_earth":return`${e.schema_name}.${e.index_name}`;case"function_using_obsolete_lang":return`${e.schema_name}.${e.function_name}`;case"unsupported_extension":return e.extension_name;case"unsupported_fdw_handler":return e.fdw_name;case"unlogged_table_with_persistent_sequence":return`${e.schema_name}.${e.table_name}`;case"user_defined_objects_in_internal_schemas":return`${e.schema_name}.${e.obj_name}`;case"active_replication_slot":return e.slot_name}})(e),a=(e=>{switch(e.type){case"objects_depending_on_pg_cron":return"Remove objects that depend on pg_cron";case"indexes_referencing_ll_to_earth":return`Drop or recreate the index on table ${e.schema_name}.${e.table_name} that references ll_to_earth()`;case"function_using_obsolete_lang":return`Update the function to use a supported language instead of ${e.lang_name}`;case"unsupported_extension":return"Remove the unsupported extension";case"unsupported_fdw_handler":return`Update or remove the FDW using the obsolete handler ${e.fdw_handler_name}`;case"unlogged_table_with_persistent_sequence":return`Convert the sequence ${e.sequence_name} to unlogged or convert the table to logged`;case"user_defined_objects_in_internal_schemas":return`Move the ${e.obj_type} to your own schema`;case"active_replication_slot":return"Drop the active replication slot"}})(e),i=(()=>{let s=encodeURIComponent;switch(e.type){case"function_using_obsolete_lang":return`/project/${t}/database/functions?schema=${s(e.schema_name)}&search=${s(e.function_name)}`;case"unsupported_extension":return`/project/${t}/database/extensions?filter=${s(e.extension_name)}`;case"indexes_referencing_ll_to_earth":return`/project/${t}/database/indexes?schema=${s(e.schema_name)}&search=${s(e.index_name)}`;case"unlogged_table_with_persistent_sequence":return`/project/${t}/database/tables?schema=${s(e.schema_name)}&search=${s(e.table_name)}`;case"user_defined_objects_in_internal_schemas":if("function"===e.obj_type)return`/project/${t}/database/functions?schema=${s(e.schema_name)}&search=${s(e.obj_name)}`;if("table"===e.obj_type)return`/project/${t}/database/tables?schema=${s(e.schema_name)}&search=${s(e.obj_name)}`;return null;case"active_replication_slot":case"objects_depending_on_pg_cron":default:return null;case"unsupported_fdw_handler":return`/project/${t}/integrations`}})();return(0,s.jsxs)("li",{className:"py-3 last:pb-0 flex flex-row gap-x-3 justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-0.5 flex-1 min-w-0",children:[(0,s.jsx)("h6",{className:"overflow-hidden text-ellipsis whitespace-nowrap min-w-0 text-sm font-normal text-foreground",children:r}),(0,s.jsx)("p",{className:"text-foreground-lighter text-xs",children:a})]}),i&&(0,s.jsx)(g.Button,{size:"tiny",type:"default",asChild:!0,children:(0,s.jsx)(n.default,{href:i,children:"Manage"})})]})},eR=({validationErrors:e})=>(0,s.jsx)(f.Admonition,{type:"note",showIcon:!1,title:"A newer version of Postgres is available",children:(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsxs)("p",{children:["The following issues must be resolved before upgrading."," ",(0,s.jsx)(eA.InlineLink,{href:`${h.DOCS_URL}/guides/platform/upgrading`,children:"Learn more"})]}),(0,s.jsx)("ul",{className:"border-t border-border-muted flex flex-col divide-y divide-border-muted",children:e.map((e,t)=>(0,s.jsx)(eT,{error:e},`${e.type}-${t}`))})]})}),eB=()=>{let{ref:e}=(0,l.useParams)(),{data:t}=(0,A.useSelectedProjectQuery)(),r=(0,Y.useFlag)("unifiedReplication"),{projectAuthAll:a,projectSettingsDatabaseUpgrades:i}=(0,es.useIsFeatureEnabled)(["project_auth:all","project_settings:database_upgrades"]),{data:o,error:d,isPending:c,isError:u,isSuccess:h}=X({projectRef:e}),{data:p,error:m,isPending:x,isError:j,isSuccess:_}=(({projectRef:e},{enabled:s=!0,...t}={})=>(0,q.useQuery)({queryKey:Z.projectKeys.serviceVersions(e),queryFn:({signal:s})=>J({projectRef:e},s),enabled:s&&void 0!==e,...t}))({projectRef:e}),{data:b}=(0,ee.useReadReplicasQuery)({projectRef:e}),{current_app_version:v,current_app_version_release_channel:S,latest_app_version:w}=o||{},C=v===w,k=(v??"").split("supabase-postgres-")[1]?.replace("-orioledb",""),N=S&&!["ga","withdrawn"].includes(S)?S:void 0,D=(0,A.useIsOrioleDb)(),I=(w??"").split("supabase-postgres-")[1],P=t?.status==="INACTIVE",$=(b??[]).length>1,O=(o?.validation_errors??[]).length>0;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.ScaffoldDivider,{}),t?.cloud_provider!=="FLY"&&(r?(0,s.jsx)(y.ScaffoldContainer,{children:(0,s.jsx)(y.ScaffoldSection,{isFullWidth:!0,children:(0,s.jsx)(z.NoticeBar,{visible:!0,type:"default",title:"Management of read replicas has moved",description:"Read replicas is now managed under Replication in the Database section.",actions:(0,s.jsx)(g.Button,{type:"default",asChild:!0,children:(0,s.jsx)(n.default,{href:`/project/${e}/database/replication`,className:"!no-underline",children:"Go to Replication"})})})})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e$.InstanceConfiguration,{}),(0,s.jsx)(y.ScaffoldDivider,{})]})),(0,s.jsx)(y.ScaffoldContainer,{children:(0,s.jsxs)(y.ScaffoldSection,{children:[(0,s.jsxs)(y.ScaffoldSectionDetail,{children:[(0,s.jsx)("h4",{className:"text-base capitalize m-0",children:"Service versions"}),(0,s.jsx)("p",{className:"text-foreground-light text-sm pr-8 mt-1",children:"Service versions and upgrade eligibility for your provisioned instance."})]}),(0,s.jsx)(y.ScaffoldSectionContent,{children:P?(0,s.jsx)(f.Admonition,{type:"note",showIcon:!1,title:"Service versions cannot be retrieved while project is paused",description:"Restoring the project will update Postgres to the newest version"}):(0,s.jsxs)(s.Fragment,{children:[c&&(0,s.jsx)(B.GenericSkeletonLoader,{}),u&&(0,s.jsx)(V.default,{error:d,subject:"Failed to retrieve Postgres version"}),h&&(0,s.jsxs)(s.Fragment,{children:[x&&(0,s.jsx)(B.GenericSkeletonLoader,{}),j&&(0,s.jsx)(V.default,{error:m,subject:"Failed to retrieve versions"}),_&&(0,s.jsxs)(s.Fragment,{children:[a&&(0,s.jsx)(er.Input,{readOnly:!0,disabled:!0,label:"Auth version",value:p?.gotrue??""}),(0,s.jsx)(er.Input,{readOnly:!0,disabled:!0,label:"PostgREST version",value:p?.postgrest??""}),(0,s.jsx)(er.Input,{readOnly:!0,disabled:!0,value:k||p?.["supabase-postgres"]||"",label:"Postgres version",actions:[N&&(0,s.jsxs)(ea.Tooltip,{children:[(0,s.jsx)(ea.TooltipTrigger,{children:(0,s.jsx)(et.Badge,{variant:"warning",className:"mr-1",children:N})}),(0,s.jsxs)(ea.TooltipContent,{side:"bottom",className:"w-44 text-center",children:["This project uses a ",N," database version release"]})]}),D&&(0,s.jsxs)(ea.Tooltip,{children:[(0,s.jsx)(ea.TooltipTrigger,{children:(0,s.jsx)(et.Badge,{variant:"default",className:"mr-1",children:"OrioleDB"})}),(0,s.jsx)(ea.TooltipContent,{side:"bottom",className:"w-44 text-center",children:"This project uses OrioleDB"})]}),C&&(0,s.jsxs)(ea.Tooltip,{children:[(0,s.jsx)(ea.TooltipTrigger,{children:(0,s.jsx)(et.Badge,{variant:"success",className:"mr-1",children:"Latest"})}),(0,s.jsx)(ea.TooltipContent,{side:"bottom",className:"w-52 text-center",children:"Project is on the latest version of Postgres that Supabase supports"})]})]})]}),i&&o&&o.eligible?$?(0,s.jsx)(eO,{latestPgVersion:I}):(0,s.jsx)(eP,{}):null,i&&o&&!o.eligible&&O?(0,s.jsx)(eR,{validationErrors:o.validation_errors??[]}):null]})]})})]})})]})};var eL=e.i(448710),eU=e.i(865389);let eM=()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.ScaffoldContainer,{children:(0,s.jsxs)(y.ScaffoldHeader,{children:[(0,s.jsx)(y.ScaffoldTitle,{children:"Infrastructure"}),(0,s.jsx)(y.ScaffoldDescription,{children:"General information regarding your server instance"})]})}),(0,s.jsx)(eB,{}),(0,s.jsx)(y.ScaffoldDivider,{}),(0,s.jsx)(E,{})]});eM.getLayout=e=>(0,s.jsx)(eL.DefaultLayout,{children:(0,s.jsx)(eU.default,{title:"Infrastructure",children:e})}),e.s(["default",0,eM],358085)},236528,(e,s,t)=>{let r="/project/[ref]/settings/infrastructure";(window.__NEXT_P=window.__NEXT_P||[]).push([r,()=>e.r(358085)]),s.hot&&s.hot.dispose(function(){window.__NEXT_P.push([r])})}]);

//# debugId=55b98691-e25a-6e32-b656-1521b0dc194c
//# sourceMappingURL=c674644142741c0b.js.map